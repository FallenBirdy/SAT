

{% extends 'home/base.html' %}

{% block title %}Workouts | Fitness Tracker{% endblock %}

{% block page_title %}Workout Tracker{% endblock %}

{% block content %}

  <div class="row">
    <div class="col-lg-6">
      <!-- Workout Logging Card -->
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="fas fa-dumbbell me-2"></i>Log Workout</h5>
        </div>
        <div class="card-body">
          <form id="workoutForm">
            <div class="mb-3">
              <label for="workoutType" class="form-label">Workout Type</label>
              <input type="text" class="form-control" id="workoutType" placeholder="e.g. Upper Body, Cardio, Leg Day, Full Body">
            </div>
            <div class="mb-3">
              <label for="workoutDetails" class="form-label">Workout Details</label>
              <textarea class="form-control" id="workoutDetails" rows="3" placeholder="e.g. 3 sets of 12 reps bench press, 30 min treadmill run"></textarea>
            </div>
            <button type="button" class="btn btn-primary" onclick="logWorkout()">
              <i class="fas fa-plus-circle me-2"></i>Log Workout
            </button>
          </form>
        </div>
      </div>
    </div>
    
    <div class="col-lg-6">
      <!-- Recent Workouts Card -->
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Workouts</h5>
        </div>
        <div class="card-body">
          <div id="workoutLog" class="list-group">
            {% if workout_info %}
              {% for workout in workout_info %}
                <div class="list-group-item list-group-item-action">
                  <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">{{ workout.type }}</h5>
                    <small class="text-muted">{{ workout.date|default:"Today" }}</small>
                  </div>
                  <p class="mb-1">{{ workout.details }}</p>
                </div>
              {% endfor %}
            {% else %}
              <p class="text-center text-muted my-4">No workouts logged yet. Start tracking your fitness journey!</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

{% block extra_js %}
<script>
function logWorkout() {
    const type = document.getElementById('workoutType').value.trim();
    const details = document.getElementById('workoutDetails').value.trim();

    if (!type || !details) {
        alert("Please fill in both workout type and details to log your workout.");
        return;
    }

    // Get current date in ISO format for storage
    const today = new Date();
    const dateStr = today.toISOString().split('T')[0];

    fetch("/log-workout/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCSRFToken()
        },
        body: JSON.stringify({
            type: type,
            details: details,
            date: dateStr
        })
    })
    .then(response => response.json())
    .then(data => {
        // Create new workout entry in the UI
        const workoutLogDiv = document.getElementById("workoutLog");
        
        // Remove "no workouts" message if it exists
        const noWorkoutsMsg = workoutLogDiv.querySelector(".text-muted");
        if (noWorkoutsMsg) {
            workoutLogDiv.innerHTML = '';
        }
        
        // Create new workout item
        const newWorkout = document.createElement("div");
        newWorkout.className = "list-group-item list-group-item-action";
        newWorkout.innerHTML = `
            <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">${type}</h5>
                <small class="text-muted">Today</small>
            </div>
            <p class="mb-1">${details}</p>
        `;
        
        // Add to the beginning of the list
        if (workoutLogDiv.firstChild) {
            workoutLogDiv.insertBefore(newWorkout, workoutLogDiv.firstChild);
        } else {
            workoutLogDiv.appendChild(newWorkout);
        }
        
        // Show success message with Bootstrap toast
        const toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        toastContainer.innerHTML = `
            <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header bg-success text-white">
                    <strong class="me-auto">Success</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${data.message}
                </div>
            </div>
        `;
        document.body.appendChild(toastContainer);
        const toastEl = toastContainer.querySelector('.toast');
        const toast = new bootstrap.Toast(toastEl);
        toast.show();
        
        // Clear form
        document.getElementById('workoutType').value = '';
        document.getElementById('workoutDetails').value = '';
    });
}

function getCSRFToken() {
    const name = 'csrftoken';
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
        let [key, val] = cookie.trim().split('=');
        if (key === name) return val;
    }
    return '';
}
</script>
{% endblock %}

{% endblock %}
